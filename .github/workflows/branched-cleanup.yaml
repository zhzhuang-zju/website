# .github/workflows/cleanup-auto-branches.yml
name: Cleanup auto-generated branches

on:
  pull_request:
    types: [closed]
    branches: [main]  # base branch

jobs:
  cleanup:
    # 仅当 PR 已合并 AND head 分支来自本仓库 AND 分支名以 "api-reference-" 开头
    if: |
      github.event.pull_request.merged == true &&
      github.event.pull_request.head.repo.full_name == "zhzhuang-zju/website" &&
      startsWith(github.event.pull_request.head.ref, 'api-reference-')
    runs-on: ubuntu-latest
    steps:
      - name: Delete auto-generated head branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          BRANCH="${{ github.event.pull_request.head.ref }}"
          echo "Deleting auto-generated branch: $BRANCH"
          gh api --method DELETE repos/zhzhuang-zju/website/git/refs/heads/$BRANCH
